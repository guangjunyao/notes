<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2017-06-03 Sat 13:31 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title></title>
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="weiwu" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline8">1. Pythonic Thinking</a>
<ul>
<li><a href="#orgheadline3">1.1. PEP 8 style guide</a>
<ul>
<li><a href="#orgheadline1">1.1.1. Naming:</a></li>
<li><a href="#orgheadline2">1.1.2. Expressions and Statements:</a></li>
</ul>
</li>
<li><a href="#orgheadline4">1.2. Differences between bytes, str, and unicode</a></li>
<li><a href="#orgheadline5">1.3. Slice Sequences</a></li>
<li><a href="#orgheadline6">1.4. Enumerate</a></li>
<li><a href="#orgheadline7">1.5. zip</a></li>
</ul>
</li>
<li><a href="#orgheadline9">2. Functions</a></li>
<li><a href="#orgheadline10">3. Classes and inheritance</a></li>
<li><a href="#orgheadline11">4. Metaclasses and atributes</a></li>
<li><a href="#orgheadline12">5. Concurrency and parallelism</a></li>
<li><a href="#orgheadline18">6. Built-in modules</a>
<ul>
<li><a href="#orgheadline13">6.1. pickle</a></li>
<li><a href="#orgheadline14">6.2. datetime</a></li>
<li><a href="#orgheadline15">6.3. Ordered dictionary</a></li>
<li><a href="#orgheadline16">6.4. Default Dictionary</a></li>
<li><a href="#orgheadline17">6.5. Decimal for precision</a></li>
</ul>
</li>
<li><a href="#orgheadline23">7. Collaboration</a>
<ul>
<li><a href="#orgheadline19">7.1. Documenting</a></li>
<li><a href="#orgheadline21">7.2. Packages</a>
<ul>
<li><a href="#orgheadline20">7.2.1. stable API</a></li>
</ul>
</li>
<li><a href="#orgheadline22">7.3. Virtual environments</a></li>
</ul>
</li>
<li><a href="#orgheadline29">8. Production</a>
<ul>
<li><a href="#orgheadline25">8.1. Test Everything with unittest</a>
<ul>
<li><a href="#orgheadline24">8.1.1. unittest.mock built-in module</a></li>
</ul>
</li>
<li><a href="#orgheadline27">8.2. Profile before optimizing</a>
<ul>
<li><a href="#orgheadline26">8.2.1. enhancing performance with Cython(writing C extensions for pandas)</a></li>
</ul>
</li>
<li><a href="#orgheadline28">8.3. Use tracemalloc to Understand Memory Usage and Leaks</a></li>
</ul>
</li>
</ul>
</div>
</div>


<div id="outline-container-orgheadline8" class="outline-2">
<h2 id="orgheadline8"><span class="section-number-2">1</span> Pythonic Thinking</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-orgheadline3" class="outline-3">
<h3 id="orgheadline3"><span class="section-number-3">1.1</span> PEP 8 style guide</h3>
<div class="outline-text-3" id="text-1-1">
</div><div id="outline-container-orgheadline1" class="outline-4">
<h4 id="orgheadline1"><span class="section-number-4">1.1.1</span> Naming:</h4>
<div class="outline-text-4" id="text-1-1-1">
<ul class="org-ul">
<li>Protected instance attributes should be in _leading<sub>underscore</sub> format.</li>
<li>Private instance attributes should be in _<sub>double</sub><sub>leading</sub><sub>underscore</sub></li>
</ul>
<p>
format.
</p>
<ul class="org-ul">
<li>Classes and exceptions should be in CapitalizedWord format.</li>
<li>Module-level constants should be in ALL<sub>CAPS</sub> format.</li>
<li>Instance methods in classes should use self as the name of the first parameter</li>
</ul>
<p>
(which refers to the object).
</p>
<ul class="org-ul">
<li>Class methods should use cls as the name of the first parameter (which refers to</li>
</ul>
<p>
the class).
</p>
</div>
</div>
<div id="outline-container-orgheadline2" class="outline-4">
<h4 id="orgheadline2"><span class="section-number-4">1.1.2</span> Expressions and Statements:</h4>
<div class="outline-text-4" id="text-1-1-2">
<ul class="org-ul">
<li>Always use absolute names for modules when importing them, not names relative to the current module’s own path. For example, to import the foo module from the bar package, you should do from bar import foo, not just import foo.</li>
<li>If you must do relative imports, use the explicit syntax from . import foo.</li>
<li>Imports should be in sections in the following order: standard library modules, thirdparty modules, your own modules. Each subsection should have imports in alphabetical order.</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgheadline4" class="outline-3">
<h3 id="orgheadline4"><span class="section-number-3">1.2</span> Differences between bytes, str, and unicode</h3>
<div class="outline-text-3" id="text-1-2">
<ul class="org-ul">
<li>In Python 3, there are two types that represent sequences of characters: bytes and str. Instances of bytes contain raw 8-bit values. Instances of str contain Unicode characters.</li>
<li>In Python 2, there are two types that represent sequences of characters: str and unicode. In contrast to Python 3, instances of str contain raw 8-bit values. Instances of unicode contain Unicode characters.</li>
<li>To convert Unicode characters to binary data, you must use the encode method. To convert binary data to Unicode characters, you must use the decode method.</li>
<li>When you’re writing Python programs, it’s important to do encoding and decoding of Unicode at the furthest boundary of your interfaces. The core of your program should use Unicode character types (str in Python 3, unicode in Python 2) and should not assume anything about character encodings.</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline5" class="outline-3">
<h3 id="orgheadline5"><span class="section-number-3">1.3</span> Slice Sequences</h3>
<div class="outline-text-3" id="text-1-3">
<ul class="org-ul">
<li>Slicing lets you access a subset of a sequence’s items with minimal effort. The simplest uses for slicing are the built-in types list, str, and bytes.</li>
<li>Python has special syntax for the stride of a slice in the form somelist[start:end:stride].</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline6" class="outline-3">
<h3 id="orgheadline6"><span class="section-number-3">1.4</span> Enumerate</h3>
<div class="outline-text-3" id="text-1-4">
<p>
enumerate wraps any iterator with a lazy generator.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #F92672;">for</span> i, flavor <span style="color: #F92672;">in</span> <span style="color: #F92672;">enumerate</span><span style="color: #AE81FF;">(</span>flavor_list<span style="color: #AE81FF;">)</span>:
<span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span>&#8216;%d: %s&#8217; % <span style="color: #66D9EF;">(</span>i + <span style="color: #AE81FF;">1</span>, flavor<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
&gt;&gt;&gt;
<span style="color: #AE81FF;">1</span>: vanilla
<span style="color: #AE81FF;">2</span>: chocolate
<span style="color: #AE81FF;">3</span>: pecan
<span style="color: #AE81FF;">4</span>: strawberry
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline7" class="outline-3">
<h3 id="orgheadline7"><span class="section-number-3">1.5</span> zip</h3>
<div class="outline-text-3" id="text-1-5">
<p>
There are two problems with the zip built-in.
</p>
<ul class="org-ul">
<li>The first issue is that in Python 2 zip is not a generator; it will fully exhaust the supplied iterators and return a list of all the tuples it creates. This could potentially use a lot of memory and cause your program to crash. If you want to zip very large iterators in Python 2, you should use izip from the itertools built-in module.</li>
<li>The second issue is that zip behaves strangely if the input iterators are of different lengths.</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgheadline9" class="outline-2">
<h2 id="orgheadline9"><span class="section-number-2">2</span> Functions</h2>
</div>

<div id="outline-container-orgheadline10" class="outline-2">
<h2 id="orgheadline10"><span class="section-number-2">3</span> Classes and inheritance</h2>
</div>

<div id="outline-container-orgheadline11" class="outline-2">
<h2 id="orgheadline11"><span class="section-number-2">4</span> Metaclasses and atributes</h2>
</div>

<div id="outline-container-orgheadline12" class="outline-2">
<h2 id="orgheadline12"><span class="section-number-2">5</span> Concurrency and parallelism</h2>
</div>

<div id="outline-container-orgheadline18" class="outline-2">
<h2 id="orgheadline18"><span class="section-number-2">6</span> Built-in modules</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-orgheadline13" class="outline-3">
<h3 id="orgheadline13"><span class="section-number-3">6.1</span> pickle</h3>
<div class="outline-text-3" id="text-6-1">
<ul class="org-ul">
<li>The pickle built-in module is only useful for serializing and deserializing objects between trusted programs.</li>
<li>The pickle module may break down when used for more than trivial use cases.</li>
<li>Use the copyreg built-in module with pickle to add missing attribute values, allow versioning of classes, and provide stable import paths.</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline14" class="outline-3">
<h3 id="orgheadline14"><span class="section-number-3">6.2</span> datetime</h3>
<div class="outline-text-3" id="text-6-2">
<p>
converting time between UTC and local clocks.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #75715E;"># </span><span style="color: #75715E;">UTC to local</span>
<span style="color: #F92672;">from</span> time <span style="color: #F92672;">import</span> localtime, strftime
<span style="color: #FD971F;">now</span> = <span style="color: #AE81FF;">1407694710</span>
<span style="color: #FD971F;">local_tuple</span> = localtime<span style="color: #AE81FF;">(</span>now<span style="color: #AE81FF;">)</span>
<span style="color: #FD971F;">time_format</span> = &#8216;%Y-%m-%d %H:%M:%S&#8217;
<span style="color: #FD971F;">time_str</span> = strftime<span style="color: #AE81FF;">(</span>time_format, local_tuple<span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span>time_str<span style="color: #AE81FF;">)</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">local to UTC</span>
<span style="color: #FD971F;">time_tuple</span> = strptime<span style="color: #AE81FF;">(</span>time_str, time_format<span style="color: #AE81FF;">)</span>
<span style="color: #FD971F;">utc_now</span> = mktime<span style="color: #AE81FF;">(</span>time_tuple<span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span>utc_now<span style="color: #AE81FF;">)</span>
</pre>
</div>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #75715E;"># </span><span style="color: #75715E;">take present time in UTC and convert it to local time.</span>
<span style="color: #F92672;">from</span> datetime <span style="color: #F92672;">import</span> datetime, timezone
<span style="color: #FD971F;">now</span> = datetime<span style="color: #AE81FF;">(</span><span style="color: #AE81FF;">2014</span>, <span style="color: #AE81FF;">8</span>, <span style="color: #AE81FF;">10</span>, <span style="color: #AE81FF;">18</span>, <span style="color: #AE81FF;">18</span>, <span style="color: #AE81FF;">30</span><span style="color: #AE81FF;">)</span>
<span style="color: #FD971F;">now_utc</span> = now.replace<span style="color: #AE81FF;">(</span>tzinfo=timezone.utc<span style="color: #AE81FF;">)</span>
<span style="color: #FD971F;">now_local</span> = now_utc.astimezone<span style="color: #AE81FF;">()</span>
<span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span>now_local<span style="color: #AE81FF;">)</span>
&gt;&gt;&gt;
<span style="color: #AE81FF;">2014</span>-<span style="color: #AE81FF;">08</span>-<span style="color: #AE81FF;">10</span> <span style="color: #AE81FF;">11</span>:<span style="color: #AE81FF;">18</span>:<span style="color: #AE81FF;">30</span>-<span style="color: #AE81FF;">07</span>:<span style="color: #AE81FF;">00</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline15" class="outline-3">
<h3 id="orgheadline15"><span class="section-number-3">6.3</span> Ordered dictionary</h3>
<div class="outline-text-3" id="text-6-3">
<p>
Standard dictionaries are unordered. That means a dict with the same keys and values can result in different orders of iteration. This behavior is a surprising byproduct of the way the dictionary’s fast hash table is implemented.
The OrderedDict class from the collections module is a special type of dictionary that keeps track of the order in which its keys were inserted. Iterating the keys of an OrderedDict has predictable behavior. This can vastly simplify testing and debugging by making all code deterministic.
</p>
</div>
</div>

<div id="outline-container-orgheadline16" class="outline-3">
<h3 id="orgheadline16"><span class="section-number-3">6.4</span> Default Dictionary</h3>
<div class="outline-text-3" id="text-6-4">
<p>
One problem with dictionaries is that you can’t assume any keys are already present.
If you wish to increment a counter stored in a dictionary when that counter key is not existed in the dictionary before, you have to assign a default value to that key.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #FD971F;">stats</span> = <span style="color: #AE81FF;">{}</span>
<span style="color: #FD971F;">key</span> = <span style="color: #E6DB74;">'my_counter'</span>
<span style="color: #F92672;">if</span> key <span style="color: #F92672;">not</span> <span style="color: #F92672;">in</span> stats:
<span style="color: #FD971F;">stats</span><span style="color: #AE81FF;">[</span>key<span style="color: #AE81FF;">]</span> = <span style="color: #AE81FF;">0</span>
<span style="color: #FD971F;">stats</span><span style="color: #AE81FF;">[</span>key<span style="color: #AE81FF;">]</span> += <span style="color: #AE81FF;">1</span>

<span style="color: #75715E;"># </span><span style="color: #75715E;">Using defaultdict doesn't have such problem.</span>
<span style="color: #F92672;">from</span> collections <span style="color: #F92672;">import</span> defaultdict
<span style="color: #FD971F;">stats</span> = defaultdict<span style="color: #AE81FF;">(</span><span style="color: #F92672;">int</span><span style="color: #AE81FF;">)</span>
<span style="color: #FD971F;">stats</span><span style="color: #AE81FF;">[</span><span style="color: #E6DB74;">'my_counter'</span><span style="color: #AE81FF;">]</span> += <span style="color: #AE81FF;">1</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline17" class="outline-3">
<h3 id="orgheadline17"><span class="section-number-3">6.5</span> Decimal for precision</h3>
<div class="outline-text-3" id="text-6-5">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #FD971F;">rounded</span> = number.quantize<span style="color: #AE81FF;">(</span>Decimal<span style="color: #66D9EF;">(</span>&#8216;<span style="color: #AE81FF;">0</span>.<span style="color: #AE81FF;">01</span>&#8217;<span style="color: #66D9EF;">)</span>, rounding=ROUND_UP<span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span>rounded<span style="color: #AE81FF;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgheadline23" class="outline-2">
<h2 id="orgheadline23"><span class="section-number-2">7</span> Collaboration</h2>
<div class="outline-text-2" id="text-7">
</div><div id="outline-container-orgheadline19" class="outline-3">
<h3 id="orgheadline19"><span class="section-number-3">7.1</span> Documenting</h3>
<div class="outline-text-3" id="text-7-1">
<p>
Write docstrings for every function, class, and module.
</p>
</div>
</div>

<div id="outline-container-orgheadline21" class="outline-3">
<h3 id="orgheadline21"><span class="section-number-3">7.2</span> Packages</h3>
<div class="outline-text-3" id="text-7-2">
<pre class="example">
--main.py
--mypackage
    |-- __init__.py
    |-- mypackage/models.py
    |-- mypackage/utils.py
</pre>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #75715E;"># </span><span style="color: #75715E;">main.py</span>
<span style="color: #F92672;">from</span> mypackage <span style="color: #F92672;">import</span> utils
</pre>
</div>
</div>

<div id="outline-container-orgheadline20" class="outline-4">
<h4 id="orgheadline20"><span class="section-number-4">7.2.1</span> stable API</h4>
<div class="outline-text-4" id="text-7-2-1">
<p>
The value of <span class="underline"><span class="underline">all</span></span> is a list of every name to
export from the module as part of its public API.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #75715E;"># </span><span style="color: #75715E;">utils.py</span>
<span style="color: #F92672;">from</span> . models <span style="color: #F92672;">import</span> Projectile
<span style="color: #FD971F;">all__</span> = <span style="color: #AE81FF;">[</span>&#8216;simulate_collision&#8217;<span style="color: #AE81FF;">]</span>
<span style="color: #F92672;">def</span> <span style="color: #A6E22E;">_dot_product</span><span style="color: #AE81FF;">(</span>a, b<span style="color: #AE81FF;">)</span>:
<span style="color: #75715E;"># </span><span style="color: #75715E;">&#8230;</span>
<span style="color: #F92672;">def</span> <span style="color: #A6E22E;">simulate_collision</span><span style="color: #AE81FF;">(</span>a, b<span style="color: #AE81FF;">)</span>:
<span style="color: #75715E;"># </span><span style="color: #75715E;">&#8230;</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">__init__.py</span>
<span style="color: #FD971F;">all__</span> = <span style="color: #AE81FF;">[]</span>
<span style="color: #F92672;">from</span> . models <span style="color: #F92672;">import</span> *
<span style="color: #FD971F;">all__</span> += models.<span style="color: #F92672;">__all__</span>
<span style="color: #F92672;">from</span> . utils <span style="color: #F92672;">import</span> *
<span style="color: #FD971F;">all__</span> += utils.<span style="color: #F92672;">__all__</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">api_consumer.py</span>
<span style="color: #F92672;">from</span> mypackage <span style="color: #F92672;">import</span> *
<span style="color: #FD971F;">a</span> = Projectile<span style="color: #AE81FF;">(</span><span style="color: #AE81FF;">1</span>.<span style="color: #AE81FF;">5</span>, <span style="color: #AE81FF;">3</span><span style="color: #AE81FF;">)</span>
<span style="color: #FD971F;">b</span> = Projectile<span style="color: #AE81FF;">(</span><span style="color: #AE81FF;">4</span>, <span style="color: #AE81FF;">1</span>.<span style="color: #AE81FF;">7</span><span style="color: #AE81FF;">)</span>
<span style="color: #FD971F;">after_a</span>, <span style="color: #FD971F;">after_b</span> = simulate_collision<span style="color: #AE81FF;">(</span>a, b<span style="color: #AE81FF;">)</span>
</pre>
</div>
<p>
internal-only functions like mypackage.utils.<sub>dot</sub><sub>product</sub> will not be
available to the API consumer on mypackage because they weren’t present in all__. Being omitted from <span class="underline"><span class="underline">all</span></span> means they weren’t imported by the from mypackage import * statement.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline22" class="outline-3">
<h3 id="orgheadline22"><span class="section-number-3">7.3</span> Virtual environments</h3>
<div class="outline-text-3" id="text-7-3">
<ul class="org-ul">
<li>By default, pip installs new packages in a global location. That</li>
</ul>
<p>
causes all Python programs on your system to be affected by these installed modules. If one package requires newer version of another package, which could cause conflict version dependency issue.
pip3 show flask
pip3 show Sphinx
</p>
<ul class="org-ul">
<li>use the pip freeze command to save all</li>
</ul>
<p>
of your explicit package dependencies into a file.
</p>
<div class="org-src-container">

<pre class="src src-python">pip freeze &gt; requirements.txt
pip install -r requirements.txt
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgheadline29" class="outline-2">
<h2 id="orgheadline29"><span class="section-number-2">8</span> Production</h2>
<div class="outline-text-2" id="text-8">
</div><div id="outline-container-orgheadline25" class="outline-3">
<h3 id="orgheadline25"><span class="section-number-3">8.1</span> Test Everything with unittest</h3>
<div class="outline-text-3" id="text-8-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #75715E;"># </span><span style="color: #75715E;">utils.py</span>
<span style="color: #F92672;">def</span> <span style="color: #A6E22E;">to_str</span><span style="color: #AE81FF;">(</span>data<span style="color: #AE81FF;">)</span>:
<span style="color: #F92672;">if</span> <span style="color: #F92672;">isinstance</span><span style="color: #AE81FF;">(</span>data, <span style="color: #F92672;">str</span><span style="color: #AE81FF;">)</span>:
    <span style="color: #F92672;">return</span> data
<span style="color: #F92672;">elif</span> <span style="color: #F92672;">isinstance</span><span style="color: #AE81FF;">(</span>data, <span style="color: #F92672;">bytes</span><span style="color: #AE81FF;">)</span>:
    <span style="color: #F92672;">return</span> data.decode<span style="color: #AE81FF;">(</span>&#8216;utf-<span style="color: #AE81FF;">8</span>&#8217;<span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">else</span>:
    <span style="color: #F92672;">raise</span> <span style="color: #66D9EF;">TypeError</span><span style="color: #AE81FF;">(</span>&#8216;Must supply <span style="color: #F92672;">str</span> <span style="color: #F92672;">or</span> <span style="color: #F92672;">bytes</span>, &#8216;
&#8216;found: %r&#8217; % data<span style="color: #AE81FF;">)</span>
</pre>
</div>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #75715E;"># </span><span style="color: #75715E;">utils_test.py</span>
<span style="color: #F92672;">from</span> unittest <span style="color: #F92672;">import</span> TestCase, main
<span style="color: #F92672;">from</span> utils <span style="color: #F92672;">import</span> to_str
<span style="color: #F92672;">class</span> <span style="color: #66D9EF;">UtilsTestCase</span><span style="color: #AE81FF;">(</span>TestCase<span style="color: #AE81FF;">)</span>:
    <span style="color: #F92672;">def</span> <span style="color: #A6E22E;">test_to_str_bytes</span><span style="color: #AE81FF;">(</span><span style="color: #F92672;">self</span><span style="color: #AE81FF;">)</span>:
        <span style="color: #F92672;">self</span>.assertEqual<span style="color: #AE81FF;">(</span>&#8216;hello&#8217;, to_str<span style="color: #66D9EF;">(</span>b&#8217;hello&#8217;<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">def</span> <span style="color: #A6E22E;">test_to_str_str</span><span style="color: #AE81FF;">(</span><span style="color: #F92672;">self</span><span style="color: #AE81FF;">)</span>:
        <span style="color: #F92672;">self</span>.assertEqual<span style="color: #AE81FF;">(</span>&#8216;hello&#8217;, to_str<span style="color: #66D9EF;">(</span>&#8216;hello&#8217;<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">def</span> <span style="color: #A6E22E;">test_to_str_bad</span><span style="color: #AE81FF;">(</span><span style="color: #F92672;">self</span><span style="color: #AE81FF;">)</span>:
        <span style="color: #F92672;">self</span>.assertRaises<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">TypeError</span>, to_str, <span style="color: #F92672;">object</span><span style="color: #66D9EF;">()</span><span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">if</span> <span style="color: #F92672;">__name__</span> == &#8216;__main__&#8217;:
    main<span style="color: #AE81FF;">()</span>
</pre>
</div>
<p>
The TestCase class provides helper methods for making assertions in your tests, such as assertEqual for verifying equality, assertTrue for verifying Boolean expressions, and assertRaises for verifying that exceptions are raised when appropriate (see help(TestCase) for more). You can define your own helper methods in TestCase subclasses to make your tests more readable; just ensure that your method names don’t begin with the word test.
</p>
</div>
<div id="outline-container-orgheadline24" class="outline-4">
<h4 id="orgheadline24"><span class="section-number-4">8.1.1</span> unittest.mock built-in module</h4>
<div class="outline-text-4" id="text-8-1-1">
<p>
<a href="http://nose.readthedocs.org/">NoseTest</a>
</p>
</div>
</div>
</div>
<div id="outline-container-orgheadline27" class="outline-3">
<h3 id="orgheadline27"><span class="section-number-3">8.2</span> Profile before optimizing</h3>
<div class="outline-text-3" id="text-8-2">
<ol class="org-ol">
<li>如何查看python程序的运行效率：</li>
</ol>
<p>
The dynamic nature of Python causes surprising behaviors in its runtime performance.
Operations you might assume are slow are actually very fast (string manipulation,
generators). Language features you might assume are fast are actually very slow (attribute
access, function calls). The true source of slowdowns in a Python program can be obscure.
The best approach is to ignore your intuition and directly measure the performance of a
program before you try to optimize it. Python provides a built-in profiler for determining
which parts of a program are responsible for its execution time. This lets you focus your
optimization efforts on the biggest sources of trouble and ignore parts of the program that
don’t impact speed.
STEPS:
1). install snakeviz using pip from cmd.
</p>
<div class="org-src-container">

<pre class="src src-shell">pip install snakeviz
</pre>
</div>

<p>
2). profile the test python file using below command.
</p>
<div class="org-src-container">

<pre class="src src-shell">$ python -m cProfile -o profile.stats test.py
<span style="color: #75715E;"># </span><span style="color: #75715E;">test.py</span>
from random import randint
<span style="color: #FD971F;">max_size</span> = <span style="color: #AE81FF;">10**4</span>
<span style="color: #FD971F;">data</span> = <span style="color: #AE81FF;">[</span>randint<span style="color: #66D9EF;">(</span><span style="color: #AE81FF;">0,</span> max_size<span style="color: #66D9EF;">)</span> <span style="color: #F92672;">for</span> _<span style="color: #F92672;"> in</span> range<span style="color: #66D9EF;">(</span>max_size<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">]</span>
<span style="color: #FD971F;">test</span> = lambda: insertion_sort<span style="color: #AE81FF;">(</span>data<span style="color: #AE81FF;">)</span>
</pre>
</div>
<p>
3). check the efficiency result from profile.stats file.
</p>
<div class="org-src-container">

<pre class="src src-shell">$ snakeviz profile.stats
</pre>
</div>
</div>
<div id="outline-container-orgheadline26" class="outline-4">
<h4 id="orgheadline26"><span class="section-number-4">8.2.1</span> enhancing performance with Cython(writing C extensions for pandas)</h4>
</div>
</div>

<div id="outline-container-orgheadline28" class="outline-3">
<h3 id="orgheadline28"><span class="section-number-3">8.3</span> Use tracemalloc to Understand Memory Usage and Leaks</h3>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: <span class="timestamp-wrapper"><span class="timestamp">&lt;2017-05-31 Wed&gt;</span></span></p>
<p class="author">Author: weiwu</p>
<p class="date">Created: 2017-06-03 Sat 13:31</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
