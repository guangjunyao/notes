<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2017-04-22 Sat 15:12 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title></title>
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="weiwu" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline1">1. Python basic operations:</a></li>
<li><a href="#orgheadline4">2. Data Analysis:</a>
<ul>
<li><a href="#orgheadline2">2.1. pandas:</a></li>
<li><a href="#orgheadline3">2.2. plot:</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1"><span class="section-number-2">1</span> Python basic operations:</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>当你运行一个Python模块 python fibo.py &lt;arguments&gt;</li>

<li>模块中的代码将会被执行，就像导入它一样，不过此时name 被设置为 “main“。这意味着，通过在你的模块末尾添加此代码.</li>
<li>can’t import module from upper directory.

<ul class="org-ul">
<li>need to add the working directory to .bashrc PYTHONPATH</li>
<li>using ipython.</li>
</ul></li>
</ul>
<p>
import os
</p>

<ul class="org-ul">
<li>print os.path.abspath(ylib._<sub>file</sub>__)</li>
</ul>
<ul class="org-ul">
<li>make a python 3 virtual environment:</li>
</ul>
<p>
mkvirtual -p python3 ENVNAME
</p>
<ul class="org-ul">
<li>get specific timezone datetime</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #FD971F;">tz</span> = pytz.timezone<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">'America/Los_Angeles'</span><span style="color: #AE81FF;">)</span>
<span style="color: #75715E;">#</span><span style="color: #75715E;">date = date.today()</span>
<span style="color: #FD971F;">now</span> = datetime.now<span style="color: #AE81FF;">()</span>
<span style="color: #FD971F;">los_angeles_time</span> = datetime.now<span style="color: #AE81FF;">(</span>tz<span style="color: #AE81FF;">)</span>
</pre>
</div>

<ul class="org-ul">
<li>use tqdm as a status bar:</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #F92672;">from</span> tqdm <span style="color: #F92672;">import</span> tqdm
<span style="color: #F92672;">from</span> time <span style="color: #F92672;">import</span> sleep
<span style="color: #F92672;">for</span> i <span style="color: #F92672;">in</span> tqdm<span style="color: #AE81FF;">(</span><span style="color: #F92672;">range</span><span style="color: #66D9EF;">(</span><span style="color: #AE81FF;">10</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>:
    sleep<span style="color: #AE81FF;">(</span><span style="color: #AE81FF;">0</span>.<span style="color: #AE81FF;">1</span><span style="color: #AE81FF;">)</span>
</pre>
</div>

<ul class="org-ul">
<li>find difference of two lists:</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #FD971F;">a</span> = <span style="color: #AE81FF;">[</span><span style="color: #AE81FF;">1</span>,<span style="color: #AE81FF;">2</span>,<span style="color: #AE81FF;">3</span>,<span style="color: #AE81FF;">2</span>,<span style="color: #AE81FF;">1</span>,<span style="color: #AE81FF;">5</span>,<span style="color: #AE81FF;">6</span>,<span style="color: #AE81FF;">5</span>,<span style="color: #AE81FF;">5</span>,<span style="color: #AE81FF;">5</span><span style="color: #AE81FF;">]</span>
<span style="color: #F92672;">import</span> collections
<span style="color: #F92672;">print</span> <span style="color: #AE81FF;">[</span>item <span style="color: #F92672;">for</span> item, count <span style="color: #F92672;">in</span> collections.Counter<span style="color: #66D9EF;">(</span>a<span style="color: #66D9EF;">)</span>.items<span style="color: #66D9EF;">()</span> <span style="color: #F92672;">if</span> count &gt; <span style="color: #AE81FF;">1</span><span style="color: #AE81FF;">]</span>
</pre>
</div>

<ul class="org-ul">
<li>列表生成式</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #AE81FF;">[</span>a.lower<span style="color: #66D9EF;">()</span> <span style="color: #F92672;">for</span> a <span style="color: #F92672;">in</span> x=<span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">'Hello'</span>, <span style="color: #E6DB74;">'World'</span>, <span style="color: #AE81FF;">18</span>, <span style="color: #E6DB74;">'Apple'</span>, <span style="color: #AE81FF;">None</span><span style="color: #66D9EF;">]</span> <span style="color: #F92672;">if</span> <span style="color: #F92672;">isinstance</span><span style="color: #66D9EF;">(</span>a,<span style="color: #F92672;">str</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">]</span>
</pre>
</div>

<ul class="org-ul">
<li>function parameter</li>
</ul>
<p>
pass the parameters boo(a=1,b=2) won’t change the value of the parameters themselves.
the sequence of the parameters are certain, you can’t change it.
函数中改变形参值不会改变原值。
</p>
<ul class="org-ul">
<li>a, b = b, a + b # 相当于：</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #FD971F;">t</span> = <span style="color: #AE81FF;">(</span>b, a + b<span style="color: #AE81FF;">)</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">t&#26159;&#19968;&#20010;tuple</span>
<span style="color: #FD971F;">a</span> = t<span style="color: #AE81FF;">[</span><span style="color: #AE81FF;">0</span><span style="color: #AE81FF;">]</span>
<span style="color: #FD971F;">b</span> = t<span style="color: #AE81FF;">[</span><span style="color: #AE81FF;">1</span><span style="color: #AE81FF;">]</span>
</pre>
</div>

<ul class="org-ul">
<li>The ^ symbol is for the bitwise ‘xor’ operation:</li>
</ul>
<p>
but in Python, the exponent operator symbol is **.
</p>

<ul class="org-ul">
<li>生成器</li>
</ul>
<p>
通过列表生成式，我们可以直接创建一个列表。但是，受到内存限制，列表容量肯定是有限的。而且，创建一个包含100万个元素的列表，不仅占用很大的存储空间，如果我们仅仅需要访问前面几个元素，那后面绝大多数元素占用的空间都白白浪费了。
要创建一个generator，有很多种方法。第一种方法很简单，只要把一个列表生成式的[]改成()，就创建了一个generator：
如果要一个一个打印出来，可以通过next()函数获得generator的下一个返回值：
next(g)
这里，最难理解的就是generator和函数的执行流程不一样。函数是顺序执行，遇到return语句或者最后一行函数语句就返回。而变成generator的函数，在每次调用next()的时候执行，遇到yield语句返回，再次执行时从上次返回的yield语句处继续执行。
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #F92672;">def</span> <span style="color: #A6E22E;">odd</span><span style="color: #AE81FF;">()</span>:
    <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">'step 1'</span><span style="color: #AE81FF;">)</span>

    <span style="color: #F92672;">yield</span> <span style="color: #AE81FF;">1</span>
    <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">'step 2'</span><span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">yield</span><span style="color: #AE81FF;">(</span><span style="color: #AE81FF;">3</span><span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">'step 3'</span><span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">yield</span><span style="color: #AE81FF;">(</span><span style="color: #AE81FF;">5</span><span style="color: #AE81FF;">)</span>
&gt;&gt;&gt; <span style="color: #FD971F;">o</span> = odd<span style="color: #AE81FF;">()</span>
&gt;&gt;&gt; <span style="color: #F92672;">next</span><span style="color: #AE81FF;">(</span>o<span style="color: #AE81FF;">)</span>
step <span style="color: #AE81FF;">1</span>
<span style="color: #AE81FF;">1</span>
&gt;&gt;&gt; <span style="color: #F92672;">next</span><span style="color: #AE81FF;">(</span>o<span style="color: #AE81FF;">)</span>
step <span style="color: #AE81FF;">2</span>
<span style="color: #AE81FF;">3</span>
&gt;&gt;&gt; <span style="color: #F92672;">next</span><span style="color: #AE81FF;">(</span>o<span style="color: #AE81FF;">)</span>
step <span style="color: #AE81FF;">3</span>
<span style="color: #AE81FF;">5</span>
&gt;&gt;&gt; <span style="color: #F92672;">next</span><span style="color: #AE81FF;">(</span>o<span style="color: #AE81FF;">)</span>
Traceback <span style="color: #AE81FF;">(</span>most recent call last<span style="color: #AE81FF;">)</span>:

  File <span style="color: #E6DB74;">"&lt;stdin&gt;"</span>, line <span style="color: #AE81FF;">1</span>, <span style="color: #F92672;">in</span> &lt;module&gt;
<span style="color: #66D9EF;">StopIteration</span>
</pre>
</div>


<ul class="org-ul">
<li>read file to a list:</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #F92672;">with</span> <span style="color: #F92672;">open</span><span style="color: #AE81FF;">(</span>r<span style="color: #E6DB74;">'y:\codes\data\smart_beta_etf_list.txt'</span>, <span style="color: #E6DB74;">'rb'</span><span style="color: #AE81FF;">)</span> <span style="color: #F92672;">as</span> f:
</pre>
</div>


<ul class="org-ul">
<li>etf<sub>list</sub> = f.readlines()</li>
</ul>

<p>
etf<sub>list</sub> = [x.strip() for x in etf<sub>list</sub>]
</p>

<ul class="org-ul">
<li>save a list to a file:</li>
</ul>
<p>
thefile = open('test.txt', 'w')
</p>

<ul class="org-ul">
<li>for item in thelist:</li>
</ul>
<p>
thefile.write("%s\n" % item)
</p>

<ul class="org-ul">
<li>replace comma as next line (enter):</li>
</ul>
<p>
choose extend mode: replace ',' as \r\n
</p>

<ul class="org-ul">
<li>string to datetime:</li>
</ul>
<p>
time.strptime(string[, format])
</p>
<ul class="org-ul">
<li>iterate key and value in a dictionary:</li>
</ul>
<p>
for k, v in dict.iteritems():
</p>
<ul class="org-ul">
<li>iterate keys in a dictionary:</li>
</ul>
<p>
for k in dict:
</p>
<ul class="org-ul">
<li>iterate a row in pandas dataframe:</li>
</ul>
<div class="org-src-container">

<pre class="src src-python">DataFrame.iterrows<span style="color: #AE81FF;">()</span>:
<span style="color: #F92672;">return</span> generator.
&gt;&gt;&gt; <span style="color: #FD971F;">df</span> = pd.DataFrame<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">[</span><span style="color: #A6E22E;">[</span><span style="color: #AE81FF;">1</span>, <span style="color: #AE81FF;">1</span>.<span style="color: #AE81FF;">5</span><span style="color: #A6E22E;">]</span><span style="color: #66D9EF;">]</span>, columns=<span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">'int'</span>, <span style="color: #E6DB74;">'float'</span><span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">)</span>
&gt;&gt;&gt; <span style="color: #FD971F;">row</span> = <span style="color: #F92672;">next</span><span style="color: #AE81FF;">(</span>df.iterrows<span style="color: #66D9EF;">()</span><span style="color: #AE81FF;">)[</span><span style="color: #AE81FF;">1</span><span style="color: #AE81FF;">]</span>
&gt;&gt;&gt; row
<span style="color: #F92672;">int</span>      <span style="color: #AE81FF;">1</span>.<span style="color: #AE81FF;">0</span>
<span style="color: #F92672;">float</span>    <span style="color: #AE81FF;">1</span>.<span style="color: #AE81FF;">5</span>
Name: <span style="color: #AE81FF;">0</span>, dtype: float64
&gt;&gt;&gt; <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span>row<span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">'int'</span><span style="color: #66D9EF;">]</span>.dtype<span style="color: #AE81FF;">)</span>
float64
&gt;&gt;&gt; <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span>df<span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">'int'</span><span style="color: #66D9EF;">]</span>.dtype<span style="color: #AE81FF;">)</span>
int64
</pre>
</div>

<p>
To preserve dtypes while iterating over the rows, it is better to use itertuples() which returns tuples of the values and which is generally faster as iterrows.
</p>

<ul class="org-ul">
<li>install setup.py:</li>
</ul>
<p>
python setup.py install
</p>
<ul class="org-ul">
<li>magic method:</li>
</ul>
<p>
getitem in a class allows its instances to use the [ ] (indexer) operators
</p>
<ul class="org-ul">
<li>setitem Called to implement assignment to self[key]</li>

<li>call magic method in a class causes its instances to become callables – in other words, those instances now behave like functions.</li>
<li>getattr overrides Python’s default mechanism for member access.</li>
<li>getattr magic method only gets invoked for attributes that are not in the dict magic attribute. Implementing getattr causes the hasattr built-in function to always return True, unless an exception is raised from within getattr.</li>
<li>setattr allows you to override Python’s default mechanism for member assignment.</li>
<li>split strings by space delimiter from reverse:</li>
</ul>

<div class="org-src-container">

<pre class="src src-python">text.rsplit<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">' '</span>, <span style="color: #AE81FF;">1</span><span style="color: #AE81FF;">)[</span><span style="color: #AE81FF;">0</span><span style="color: #AE81FF;">]</span>
</pre>
</div>

<ul class="org-ul">
<li>split strings by space delimiter from beginning:</li>
</ul>
<div class="org-src-container">

<pre class="src src-python">text.split<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">' '</span>, <span style="color: #AE81FF;">1</span><span style="color: #AE81FF;">)[</span><span style="color: #AE81FF;">0</span><span style="color: #AE81FF;">]</span>
&gt;&gt;&gt;a.split<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">'.'</span>,<span style="color: #AE81FF;">1</span><span style="color: #AE81FF;">)</span>
<span style="color: #AE81FF;">[</span><span style="color: #E6DB74;">'alvy'</span>,<span style="color: #E6DB74;">'test.txt'</span><span style="color: #AE81FF;">]</span>
&#21518;&#38754;&#22810;&#20102;&#19968;&#20010;&#21442;&#25968;1&#65292;&#20197;&#31532;&#19968;&#20010;<span style="color: #E6DB74;">'.'</span>&#20998;&#30028;&#65292;&#20998;&#25104;&#20004;&#20010;&#23383;&#31526;&#20018;&#65292;&#32452;&#25104;&#19968;&#20010;list
&gt;&gt;&gt;a.rsplit<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">'.'</span>,<span style="color: #AE81FF;">1</span><span style="color: #AE81FF;">)</span>
<span style="color: #AE81FF;">[</span><span style="color: #E6DB74;">'alvy.test'</span>,<span style="color: #E6DB74;">'txt'</span><span style="color: #AE81FF;">]</span>
&#29616;&#22312;&#26159;rsplit&#20989;&#25968;&#65292;&#20174;&#21491;&#36793;&#31532;&#19968;&#20010;<span style="color: #E6DB74;">'.'</span>&#20998;&#30028;&#65292;&#20998;&#25104;&#20004;&#20010;&#23383;&#31526;&#20018;&#65292;&#32452;&#25104;&#19968;&#20010;list
</pre>
</div>

<ul class="org-ul">
<li>unittest:</li>
</ul>
<p>
check data operation:
create, select, update, delete.
</p>

<ul class="org-ul">
<li>checking parameter types, classes, or values.</li>
<li>checking data structure invariants.</li>
<li>checking “can’t happen” situations (duplicates in a list, contradictory state variables.)</li>
<li>after calling a function, to make sure that its return is reasonable.</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline4" class="outline-2">
<h2 id="orgheadline4"><span class="section-number-2">2</span> Data Analysis:</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-orgheadline2" class="outline-3">
<h3 id="orgheadline2"><span class="section-number-3">2.1</span> pandas:</h3>
<div class="outline-text-3" id="text-2-1">
<ul class="org-ul">
<li>generate a dataframe:</li>
</ul>
<p>
dates = pd.date<sub>range</sub>('1/1/2000', periods=8)
df = pd.DataFrame(np.random.randn(8, 4), index=dates, columns=['A', 'B', 'C', 'D'])
</p>
<ul class="org-ul">
<li>connection with mysql:</li>
</ul>
<p>
pandas.read<sub>sql</sub><sub>query</sub>(sql, con=engine):
</p>

<ul class="org-ul">
<li>pandas.read<sub>sql</sub><sub>table</sub>(table<sub>name</sub>, con=engine):</li>
<li>pandas.read<sub>sql</sub>(sql, con=engine)</li>

<li>sql = 'DROP TABLE IF EXISTS etf<sub>daily</sub><sub>price</sub>;'</li>
</ul>
<p>
result = engine.execute(sql)
</p>
<ul class="org-ul">
<li>find all the values of TRUE in a dataframe:</li>
</ul>
<p>
z=(a!=b)
pd.concat([a.ix[z[reduce(lambda x, y: x | z[y], z, False)].index],b.ix[z[reduce(lambda x, y: x | z[y], z, False)].index]],axis=1)
</p>
<ul class="org-ul">
<li>remove negative value from a column:</li>
</ul>
<p>
1). filtered<sub>1</sub>=b[‘TRADE<sub>size</sub>’].apply(lambda x: 0 if x &lt; 0 else x)
2). b[‘TRADE<sub>size</sub>’].loc[ b[‘TRADE<sub>size</sub>’]&lt;0, ‘TRADE<sub>size</sub>’] = 0
percentage output format:
from future import division
</p>
<ul class="org-ul">
<li>print “%s %.4f%%” % (sid, (len(not<sub>close</sub>)/len(ctp)))</li>
<li>rename column names:</li>
</ul>
<p>
df<sub>bbg</sub> = df<sub>bbg.rename</sub>(columns = lambda x: x[:4].replace(' ',''))
</p>

<ul class="org-ul">
<li>remove characters after space:</li>
</ul>
<p>
df<sub>bbg</sub> = df<sub>bbg.rename</sub>(columns = lambda x: x.)
</p>
<ul class="org-ul">
<li>pandas long format to pivot:</li>
</ul>
<p>
pivoted = df.pivot('name1','name2','name3')
</p>

<p>
access hierarchical index.
</p>

<p>
A MultiIndex can be created from a list of arrays (using MultiIndex.from<sub>arrays</sub>), an array of tuples (using MultiIndex.from<sub>tuples</sub>), or a crossed set of iterables (using MultiIndex.from<sub>product</sub>).
</p>
<div class="org-src-container">

<pre class="src src-python">df.loc<span style="color: #AE81FF;">[</span>&#8216;date&#8217;,&#8217;col&#8217;<span style="color: #AE81FF;">]</span>, df<span style="color: #AE81FF;">[</span>&#8216;date&#8217;<span style="color: #AE81FF;">]</span>, df.ix<span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">[</span>&#8216;date1&#8217;, &#8216;date2&#8217;<span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">]</span>
</pre>
</div>
<ul class="org-ul">
<li>slicing:</li>
</ul>
<div class="org-src-container">

<pre class="src src-python">df.loc<span style="color: #AE81FF;">[</span><span style="color: #E6DB74;">'start'</span>:<span style="color: #E6DB74;">'end'</span>,<span style="color: #AE81FF;">]</span>, df<span style="color: #AE81FF;">[</span><span style="color: #E6DB74;">'start'</span>: <span style="color: #E6DB74;">'end'</span><span style="color: #AE81FF;">]</span>
</pre>
</div>

<ul class="org-ul">
<li>slice with a ‘range’ of values, by providing a slice of tuples:</li>
</ul>
<p>
df.loc[('2006-11-02','USO.US'):('2006-11-06','USO.US')]
</p>

<ul class="org-ul">
<li>df.loc(axis=0)[:,['SPY.US']]</li>
<li>select certain columns:</li>
</ul>
<p>
df.loc(axis=0)[:,['SPY.US']]['updatedTime']
</p>

<ul class="org-ul">
<li>select date range using pd series.</li>
</ul>
<p>
date<sub>not</sub><sub>inserted</sub> = whole<sub>index</sub>[~whole<sub>index.isin</sub>(date<sub>in</sub><sub>database</sub>['date'])]
df<sub>need</sub><sub>to</sub><sub>be</sub><sub>updated</sub> = whole<sub>df</sub><sub>stack.ix</sub>[days<sub>not</sub><sub>in</sub><sub>db</sub>]
</p>

<ul class="org-ul">
<li>remove pandas duplicated index</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"></pre>
</div>

<p>
1). grouped = sym.groupby(level=0)
</p>
<ul class="org-ul">
<li>sym = grouped.last()</li>

<li>2).df2[~df2.index.duplicated()]</li>
<li>set column as datetime index</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"></pre>
</div>

<p>
df = df.set<sub>index</sub>(pd.DatetimeIndex(df['Date']))
</p>
<ul class="org-ul">
<li>change index name:</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"></pre>
</div>

<p>
df.index.names = ['Date']
</p>
<ul class="org-ul">
<li>for loop in pandas dataframe:</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"></pre>
</div>

<p>
for index, value in DataFrame:
</p>
<ul class="org-ul">
<li>compare two time series:</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"></pre>
</div>

<p>
s1[s1.isin(s2)]
ax = df1.plot()
df2.plot(ax=ax)
</p>

<ul class="org-ul">
<li>datetime to string:</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"></pre>
</div>

<p>
df.index.strftime("%Y-%m-%d %H:%M:%S")
</p>
<ul class="org-ul">
<li>concaterate index</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"></pre>
</div>

<p>
pd.concat([df1, df2], axis=1)
</p>
<ul class="org-ul">
<li>change the time or date or a datetime:</li>
</ul>
<p>
end = end.replace(hour=23, minute=59, second=59)
</p>

<ul class="org-ul">
<li>万德 wind python pandas</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #FD971F;">df</span> = pd.Dataframe<span style="color: #AE81FF;">(</span>data = w.wsd<span style="color: #66D9EF;">()</span>.Data<span style="color: #66D9EF;">[</span><span style="color: #AE81FF;">0</span><span style="color: #66D9EF;">]</span>, index=w.wsd<span style="color: #66D9EF;">()</span>.Times<span style="color: #AE81FF;">)</span>
</pre>
</div>
<ul class="org-ul">
<li>concaterate:</li>
</ul>
<p>
pd.concat([df1, df2], axis=0).sort<sub>index</sub>()
pd.concat([df1, df2], axis=1)
result = df1.join(df2, how='outer’)
</p>

<ul class="org-ul">
<li>python解释器CPython.</li>

<li>如果字符串里面有’\’,而实际上要把斜杠加到字符串里面，要在前面加r，代表raw. 例如r’Y:\codes’.</li>
<li>count nan:</li>
</ul>
<p>
np.count<sub>nonzero</sub>(~np.isnan(df['series']))
</p>

<ul class="org-ul">
<li>如果主目录下有子目录packages，记得要在子目录下加init.py，最好在主目录下建main.py函数。</li>

<li>解释器如果执行哪个一个文件为主程序，如 python program1.py，it will set the special variable name to program1.py equals to ‘main’</li>
<li>One of the reasons for doing this is that sometimes you write a module (a .py file) where it can be executed directly. Alternatively, it can also be imported and used in another module. By doing the main check, you can have that code only execute when you want to run the module as a program and not have it execute when someone just wants to import your module and call your functions themselves.</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline3" class="outline-3">
<h3 id="orgheadline3"><span class="section-number-3">2.2</span> plot:</h3>
<div class="outline-text-3" id="text-2-2">
<p>
pandas plot.
</p>

<p>
using matplotlib:
</p>
<ul class="org-ul">
<li>import matplotlib.pyplot as plt</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #FD971F;">fig</span> = plt.figure<span style="color: #AE81FF;">()</span>
<span style="color: #FD971F;">ax1</span> = fig.add_subplot<span style="color: #AE81FF;">(</span><span style="color: #AE81FF;">2</span>, <span style="color: #AE81FF;">2</span>, <span style="color: #AE81FF;">1</span><span style="color: #AE81FF;">)</span>
<span style="color: #FD971F;">ax2</span> = fig.add_subplot<span style="color: #AE81FF;">(</span><span style="color: #AE81FF;">2</span>, <span style="color: #AE81FF;">2</span>, <span style="color: #AE81FF;">2</span><span style="color: #AE81FF;">)</span>
<span style="color: #FD971F;">ax3</span> = fig.add_subplot<span style="color: #AE81FF;">(</span><span style="color: #AE81FF;">2</span>, <span style="color: #AE81FF;">2</span>, <span style="color: #AE81FF;">3</span><span style="color: #AE81FF;">)</span>
<span style="color: #FD971F;">fig</span>, <span style="color: #FD971F;">axes</span> = plt.subplots<span style="color: #AE81FF;">(</span><span style="color: #AE81FF;">2</span>,<span style="color: #AE81FF;">3</span><span style="color: #AE81FF;">)</span>
fig, ax : <span style="color: #F92672;">tuple</span>
</pre>
</div>

<ul class="org-ul">
<li>highlight a certain value in the plot:</li>
</ul>
<div class="org-src-container">

<pre class="src src-python">a<span style="color: #AE81FF;">[</span><span style="color: #E6DB74;">'DGAZ.US'</span><span style="color: #AE81FF;">]</span>.hist<span style="color: #AE81FF;">(</span>bins=<span style="color: #AE81FF;">50</span><span style="color: #AE81FF;">)</span>
plt.axvline<span style="color: #AE81FF;">(</span>a<span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">'DGAZ.US'</span><span style="color: #66D9EF;">][</span>-<span style="color: #AE81FF;">1</span><span style="color: #66D9EF;">]</span>, color=<span style="color: #E6DB74;">'b'</span>, linestyle=<span style="color: #E6DB74;">'dashed'</span>, linewidth=<span style="color: #AE81FF;">2</span><span style="color: #AE81FF;">)</span>
</pre>
</div>

<p>
fig is the :class:matplotlib.figure.Figure object.
</p>

<ul class="org-ul">
<li>ax can be either a single axis object or an array of axis</li>
<li>objects if more than one subplot was created.</li>
</ul>

<p>
[<a href="http://docs.pythontab.com/interpy/args_kwargs/Usage_args/">http://docs.pythontab.com/interpy/args_kwargs/Usage_args/</a>]
</p>

<p>
[<a href="http://python.usyiyi.cn/python_278/library/index.html">http://python.usyiyi.cn/python_278/library/index.html</a>]
</p>

<p>
[<a href="https://docs.python.org/2/reference/simple_stmts.html?highlight=assert">https://docs.python.org/2/reference/simple_stmts.html?highlight=assert</a>]
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: <span class="timestamp-wrapper"><span class="timestamp">&lt;2017-04-22 Sat&gt;</span></span></p>
<p class="author">Author: weiwu</p>
<p class="date">Created: 2017-04-22 Sat 15:12</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
