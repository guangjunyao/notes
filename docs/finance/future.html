<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2017-09-12 Tue 16:42 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title></title>
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="weiwu" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline22">1. future trade simulation</a>
<ul>
<li><a href="#orgheadline1">1.1. functions</a></li>
<li><a href="#orgheadline13">1.2. futures:</a>
<ul>
<li><a href="#orgheadline2">1.2.1. 期货合约命名规则：</a></li>
<li><a href="#orgheadline5">1.2.2. 期货合约品种:</a></li>
<li><a href="#orgheadline10">1.2.3. 国内future exchange:</a></li>
<li><a href="#orgheadline11">1.2.4. dominant_future - 期货主力合约</a></li>
<li><a href="#orgheadline12">1.2.5. 保证金</a></li>
</ul>
</li>
<li><a href="#orgheadline21">1.3. 算法</a></li>
</ul>
</li>
</ul>
</div>
</div>


<div id="outline-container-orgheadline22" class="outline-2">
<h2 id="orgheadline22"><span class="section-number-2">1</span> future trade simulation</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-orgheadline1" class="outline-3">
<h3 id="orgheadline1"><span class="section-number-3">1.1</span> functions</h3>
<div class="outline-text-3" id="text-1-1">
<ul class="org-ul">
<li>rolling on constant maturity.</li>

<li>buy current and roll.</li>

<li>buy constant maturity trend following.</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline13" class="outline-3">
<h3 id="orgheadline13"><span class="section-number-3">1.2</span> futures:</h3>
<div class="outline-text-3" id="text-1-2">
<p>
由期货交易所统一制定的、规定在将来某一特定的时间和地点交割一定数量和质量标的物的标准化合约。
</p>
</div>

<div id="outline-container-orgheadline2" class="outline-4">
<h4 id="orgheadline2"><span class="section-number-4">1.2.1</span> 期货合约命名规则：</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
品种名+交割月份
</p>
</div>
</div>

<div id="outline-container-orgheadline5" class="outline-4">
<h4 id="orgheadline5"><span class="section-number-4">1.2.2</span> 期货合约品种:</h4>
<div class="outline-text-4" id="text-1-2-2">
<p>
商品期货和金融期货。
</p>

<p>
商品期货又分工业品（可细分为金属商品（贵金属与非贵金属商品）、能源商品）、农产品、其他商品等。
</p>

<p>
金融期货主要是传统的金融商品（工具）如股指、利率、汇率等，各类期货交易包括期权交易等。
</p>
</div>

<ol class="org-ol"><li><a id="orgheadline3"></a>商品期货<br  /><div class="outline-text-5" id="text-1-2-2-1">
<ul class="org-ul">
<li>农产品期货：如大豆、豆油、豆粕、籼稻、小麦、玉米、棉花、白糖、咖啡、猪腩、菜籽油、棕榈油。</li>

<li>金属期货：如铜、铝、锡、铅、锌、镍、黄金、白银、螺纹钢、线材。</li>

<li>能源期货：如原油（塑料、PTA、PVC）、汽油（甲醇）、燃料油。新兴品种包括气温、二氧化碳排放配额、天然橡胶。</li>
</ul>
</div></li>

<li><a id="orgheadline4"></a>金融期货<br  /><div class="outline-text-5" id="text-1-2-2-2">
<ul class="org-ul">
<li>股指期货：</li>
</ul>
<p>
如沪深300指数, 'IF'
</p>

<ul class="org-ul">
<li>利率期货（Interest rate futures）：</li>
</ul>
<p>
利率期货是指以债券类证券为标的物的期货合约，它可以避免利率波动所引起的证券价格变动的风险。利率期货一般可分为短期利率期货和长期利率期货，前者大多以银行同业拆借中场3月期利率为标的物、后者大多以5年期以上长期债券为标的物。
</p>

<ul class="org-ul">
<li>外汇期货(foreign exchange futures):</li>
</ul>
<p>
又称为货币期货，是一种在最终交易日按照当时的汇率将一种货币兑换成另外一种货币的期货合约。是指以汇率为标的物的期货合约，用来回避汇率风险。它是金融期货中最早出现的品种。
</p>

<ul class="org-ul">
<li>贵金属期货</li>
</ul>
<p>
主要以黄金、白银为标的物的期货合约。
</p>

<p>
贵金属按化学元素周期表命名，黄金为‘au’，白银为‘ag’。
</p>
</div></li></ol>
</div>

<div id="outline-container-orgheadline10" class="outline-4">
<h4 id="orgheadline10"><span class="section-number-4">1.2.3</span> 国内future exchange:</h4>
<div class="outline-text-4" id="text-1-2-3">
</div><ol class="org-ol"><li><a id="orgheadline6"></a>郑州商品交易所（ZCE）<br  /><div class="outline-text-5" id="text-1-2-3-1">
<p>
交易的品种有强筋小麦、普通小麦、PTA、一号棉花、白糖、菜籽油、早籼稻、玻璃、菜籽、菜粕、甲醇等16个期货品种.
</p>
</div></li>

<li><a id="orgheadline7"></a>上海期货交易所（SHFE）<br  /><div class="outline-text-5" id="text-1-2-3-2">
<p>
目前上市交易的有黄金、白银、铜、铝、锌、铅、螺纹钢、线材、燃料油、天然橡胶沥青等11个期货品种。
</p>
</div></li>

<li><a id="orgheadline8"></a>大连商品交易所（DCE）<br  /><div class="outline-text-5" id="text-1-2-3-3">
<p>
是中国东北地区唯一一家期货交易所。上市交易的有玉米、黄大豆1号、黄大豆2号、豆粕、豆油、棕榈油、聚丙烯、聚氯乙烯、塑料、焦炭、焦煤、铁矿石、胶合板、纤维板、鸡蛋等15个期货品种。
</p>
</div></li>

<li><a id="orgheadline9"></a>中国金融期货交易所（CFFEX）<br  /><div class="outline-text-5" id="text-1-2-3-4">
<p>
交易品种有股指期货，国债期货。
</p>
</div></li></ol>
</div>

<div id="outline-container-orgheadline11" class="outline-4">
<h4 id="orgheadline11"><span class="section-number-4">1.2.4</span> dominant_future - 期货主力合约</h4>
<div class="outline-text-4" id="text-1-2-4">
<p>
合约首次上市时，以当日收盘同品种持仓量最大者作为从第二个交易日开始的主力合约。当同品种其他合约持仓量在收盘后超过当前主力合约1.1倍时，从第二个交易日开始进行主力合约的切换。日内不会进行主力合约的切换。
</p>
</div>
</div>

<div id="outline-container-orgheadline12" class="outline-4">
<h4 id="orgheadline12"><span class="section-number-4">1.2.5</span> 保证金</h4>
<div class="outline-text-4" id="text-1-2-5">
<p>
参考各交易所各品种手册。
</p>

<p>
for example:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">交易品种</td>
<td class="org-left">黄金</td>
</tr>

<tr>
<td class="org-left">交易单位</td>
<td class="org-left">1000克/手</td>
</tr>

<tr>
<td class="org-left">报价单位</td>
<td class="org-left">元（人民币）/克</td>
</tr>

<tr>
<td class="org-left">最小变动价位</td>
<td class="org-left">0.05元/克</td>
</tr>

<tr>
<td class="org-left">每日价格最大波动限制</td>
<td class="org-left">不超过上一交易日结算价±3%</td>
</tr>

<tr>
<td class="org-left">合约交割月份</td>
<td class="org-left">最近三个连续月份的合约以及最近13个月以内的双月合约</td>
</tr>

<tr>
<td class="org-left">交易时间</td>
<td class="org-left">上午9:00－11:30 ，下午1:30－3:00和交易所规定的其他交易时间</td>
</tr>

<tr>
<td class="org-left">最后交易日</td>
<td class="org-left">合约交割月份的15日（遇法定假日顺延）</td>
</tr>

<tr>
<td class="org-left">交割日期</td>
<td class="org-left">最后交易日后连续五个工作日</td>
</tr>

<tr>
<td class="org-left">交割品级</td>
<td class="org-left">金含量不小于99.95%的国产金锭及经交易所认可的伦敦金银市场协会（LBMA）认定的合格供货商或精炼厂生产的标准金锭</td>
</tr>

<tr>
<td class="org-left">交割地点</td>
<td class="org-left">交易所指定交割金库</td>
</tr>

<tr>
<td class="org-left">最低交易保证金</td>
<td class="org-left">合约价值的4%</td>
</tr>

<tr>
<td class="org-left">交割方式</td>
<td class="org-left">实物交割</td>
</tr>

<tr>
<td class="org-left">交易代码</td>
<td class="org-left">AU</td>
</tr>

<tr>
<td class="org-left">上市交易所</td>
<td class="org-left">上海期货交易所</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="outline-container-orgheadline21" class="outline-3">
<h3 id="orgheadline21"><span class="section-number-3">1.3</span> 算法</h3>
<div class="outline-text-3" id="text-1-3">
</div><ol class="org-ol"><li><a id="orgheadline14"></a>trading calendar:<br  /><div class="outline-text-5" id="text-1-3-0-1">
<ul class="org-ul">
<li>future calendar spread adjustment, 合成一个连续合约.</li>
</ul>
</div></li>

<li><a id="orgheadline15"></a>future attributes:<br  /><div class="outline-text-5" id="text-1-3-0-2">
<ul class="org-ul">
<li>root_symbol: The root symbol of the underlying asset. For example, CL corresponds to crude oil.</li>

<li>start_date: The date the contract becomes available on Quantopian. Note that the price of a contract might be NaN near the start_date, as it may not be actively traded until it gets closer to its delivery date.</li>

<li>end_date: The last date the contract can be traded or closed before delivery.</li>

<li>notice_date: The date in which the exchange can start assigning delivery to accounts holding long positions on the contract.</li>

<li>auto_close_date: This is two days prior to either notice_date or end_date, whichever is earlier. In backtesting, positions in contracts will be automatically closed out on their auto_close_date.</li>

<li>tick_size: The increment in which the price of the future can change. For example, CL changes in increments of $0.01.</li>

<li>multiplier: The number of units per contract. For example, a contract for CL corresponds to 1000 barrels of oil.</li>
</ul>
</div></li>

<li><a id="orgheadline16"></a>future contract value:<br  /><div class="outline-text-5" id="text-1-3-0-3">
<p>
To better understand the need for continuous futures, let's get pricing data for the chain of individual contracts and plot it.
</p>


<div class="figure">
<p><img src="./images/futures_value.png" alt="futures_value.png" />
</p>
<p><span class="figure-number">Figure 1:</span> future contract</p>
</div>

<p>
The price difference between contracts at a given time is not considered to be an increase in value in the future. Instead, it is associated with the carrying cost and the opportunity cost of holding the underlying commodity or asset prior to delivery.
</p>

<div id="orgparagraph1" class="figure">
<p><img src="./images/active_contract.png" alt="active_contract.png" />
</p>
<p><span class="figure-number">Figure 2:</span> active contract</p>
</div>
</div></li>

<li><a id="orgheadline17"></a>adjustment styles<br  /><div class="outline-text-5" id="text-1-3-0-4">
<ul class="org-ul">
<li>multiplying</li>
</ul>
<p>
The Proportionality Adjustment approach is similar to the adjustment methodology of handling stock splits in equities. Rather than taking an absolute shift in the successive contracts, the ratio of the older settle (close) price to the newer open price is used to proportionally adjust the prices of historical contracts. This allows a continous stream without an interruption of the calculation of percentage returns.
</p>

<p>
The main issue with proportional adjustment is that any trading strategies reliant on an absolute price level will also have to be similarly adjusted in order to execute the correct signal. This is a problematic and error-prone process. <b>Thus this type of continuous stream is often only useful for summary statistical analysis, as opposed to direct backtesting research.</b>
</p>

<ul class="org-ul">
<li>add</li>
</ul>
<p>
What we have to do is adjust all previous prices up by the gap. This effectively "closes" the gap.
</p>

<p>
The key problem with the Panama method includes the introduction of a trend bias, which will introduce a large drift to the prices. This can lead to negative data for sufficiently historical contracts. In addition there is a loss of the relative price differences due to an absolute shift in values. This means that returns are complicated to calculate (or just plain incorrect).
</p>

<ul class="org-ul">
<li>None</li>
</ul>
</div></li>

<li><a id="orgheadline18"></a>roll styles<br  /><div class="outline-text-5" id="text-1-3-0-5">
<p>
position management.
</p>

<p>
Rolling the position reference to calendar or volume(dominant contract).
</p>
<ul class="org-ul">
<li>calendar</li>
</ul>
<p>
This is two days prior to either notice_date or end_date, whichever is earlier.
</p>

<ul class="org-ul">
<li>volume</li>
</ul>
<p>
期货主力合约
</p>
</div></li>

<li><a id="orgheadline19"></a>Slippage<br  /><div class="outline-text-5" id="text-1-3-0-6">
<p>
<a href="https://www.quantopian.com/tutorials/futures-getting-started#lesson11">https://www.quantopian.com/tutorials/futures-getting-started#lesson11</a>
</p>

<p>
<a href="https://www.quantopian.com/posts/quantopians-slippage-model-for-futures%20">https://www.quantopian.com/posts/quantopians-slippage-model-for-futures%20</a>
</p>

<p>
When an order is placed for a contract, the market is affected. Buy orders drive prices up, and sell orders drive prices down; this is generally referred to as the price impact of a trade. Additionally, orders do not necessarily fill instantaneously. Fill rates are dependent on the order size and current trading volume of the ordered contract.
</p>

<p>
On Quantopian, slippage on futures contracts is calculated using a special volatility volume share model. The volatility volume share model uses trailing 20-day trading volume and volatility to compute the price impact and fill rate of an order. Each underlying commodity/asset has its own model fit to historical data.
</p>

<div class="figure">
<p><img src="./images/market_impact.png" alt="market_impact.png" />
</p>
<p><span class="figure-number">Figure 3:</span> market impact</p>
</div>
</div></li>

<li><a id="orgheadline20"></a>commission:<br  /><div class="outline-text-5" id="text-1-3-0-7">
<p>
commissions charged per contract as well as exchange fees charged per trade.
</p>

<p>
仓位金：总资金*（X%-Y%）；
</p>

<p>
单笔最大允许亏损额&lt;=总资产*Z%；
</p>

<p>
单手开仓价：（现价*交易单位*保证金）+手续费；
</p>

<p>
默认手数（最大开仓）：仓位金/单手开仓价；
</p>

<p>
期货品种波动一个价位的值：最小变动价*交易单位*开仓手数；
</p>
</div></li></ol>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: <span class="timestamp-wrapper"><span class="timestamp">&lt;2017-09-12 Tue&gt;</span></span></p>
<p class="author">Author: weiwu</p>
<p class="date">Created: 2017-09-12 Tue 16:42</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
